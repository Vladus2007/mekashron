services:
  - type: web
    name: umbraco-sqlite
    env: docker
    dockerfilePath: ./Dockerfile
    envVars:
      - key: ASPNETCORE_ENVIRONMENT
        value: Production
      - key: ASPNETCORE_URLS
        value: http://*:$PORT
      # Принудительно указываем путь к данным
      - key: Umbraco__CMS__DataDirectory
        value: /app/App_Data
      # Для отладки включаем логи
      - key: Serilog__MinimumLevel__Default
        value: Debug
    # Диски для хранения данных
    disks:
      - name: appdata
        mountPath: /app/App_Data
        sizeGB: 1
      - name: media
        mountPath: /app/wwwroot/media
        sizeGB: 5
    healthCheckPath: /umbraco
    autoDeploy: true
    # Пробуем увеличить таймауты
    initialDelaySec: 60
    maxShutdownDelaySec: 30